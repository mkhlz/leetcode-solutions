<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Play Analysis IV - Visual Explanation</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 10px;
            font-size: 2.5em;
            font-weight: 700;
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 30px;
            font-size: 1.2em;
        }
        
        .problem-statement {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .section {
            margin-bottom: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid #667eea;
        }
        
        .section h2 {
            color: #4a5568;
            margin-top: 0;
            font-size: 1.8em;
            font-weight: 600;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.9em;
            letter-spacing: 0.5px;
        }
        
        tr:hover {
            background-color: #f1f5f9;
            transform: scale(1.01);
            transition: all 0.2s ease;
        }
        
        .step {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #10b981;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .step h3 {
            color: #059669;
            margin-top: 0;
            font-size: 1.3em;
        }
        
        .highlight {
            background: linear-gradient(120deg, #a8edea 0%, #fed6e3 100%);
            padding: 3px 8px;
            border-radius: 5px;
            font-weight: 600;
        }
        
        .sql-code {
            background: #1a1a1a;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 15px 0;
            border: 2px solid #444;
        }
        
        .sql-keyword {
            color: #ff79c6;
            font-weight: bold;
        }
        
        .sql-function {
            color: #50fa7b;
        }
        
        .sql-string {
            color: #f1fa8c;
        }
        
        .visual-demo {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .player-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }
        
        .player-card.retention {
            border-color: #10b981;
            background: linear-gradient(135deg, #ecfdf5, #f0fdf4);
        }
        
        .player-card.no-retention {
            border-color: #ef4444;
            background: linear-gradient(135deg, #fef2f2, #fef2f2);
        }
        
        .timeline {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }
        
        .day-marker {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            margin-right: 10px;
            font-size: 0.9em;
        }
        
        .day-login {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }
        
        .day-no-login {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
        }
        
        .formula {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            margin: 20px 0;
            box-shadow: 0 10px 25px rgba(251, 191, 36, 0.2);
        }
        
        .result-highlight {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            margin: 20px 0;
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Game Play Analysis IV</h1>
        <p class="subtitle">LeetCode Problem 550 - Player Retention Analysis</p>
        
        <div class="problem-statement">
            <h2 style="margin-top: 0;">Problem Statement</h2>
            <p>Write a SQL query to report the <strong>fraction of players</strong> that logged in again on the day after the date they first logged in, rounded to <strong>2 decimal places</strong>.</p>
            <p>In other words, you need to count the number of players that logged in for at least two days in a row, starting from their first login date, then divide that number by the total number of players.</p>
        </div>

        <div class="section">
            <h2>üìä Input Table: Activity</h2>
            <table>
                <thead>
                    <tr>
                        <th>player_id</th>
                        <th>device_id</th>
                        <th>event_date</th>
                        <th>games_played</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>2</td>
                        <td>2016-03-01</td>
                        <td>5</td>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td>2</td>
                        <td>2016-03-02</td>
                        <td>6</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>3</td>
                        <td>2017-06-25</td>
                        <td>1</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>1</td>
                        <td>2016-03-02</td>
                        <td>0</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>4</td>
                        <td>2018-07-03</td>
                        <td>5</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>üîç Step-by-Step Analysis</h2>
            
            <div class="step">
                <h3>Step 1: Find First Login Date for Each Player</h3>
                <p>We need to identify when each player first logged in:</p>
                <div class="sql-code">
<span class="sql-keyword">SELECT</span> player_id, <span class="sql-function">MIN</span>(event_date) <span class="sql-keyword">AS</span> first_login
<span class="sql-keyword">FROM</span> Activity
<span class="sql-keyword">GROUP BY</span> player_id
                </div>
                <table>
                    <thead>
                        <tr><th>player_id</th><th>first_login</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>1</td><td>2016-03-01</td></tr>
                        <tr><td>2</td><td>2017-06-25</td></tr>
                        <tr><td>3</td><td>2016-03-02</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="step">
                <h3>Step 2: Check if Players Logged in the Next Day</h3>
                <p>Join the activity table with first login dates to see if players logged in on <span class="highlight">first_login + 1 day</span>:</p>
                <div class="sql-code">
<span class="sql-keyword">SELECT</span> 
    fl.player_id,
    fl.first_login,
    <span class="sql-keyword">CASE WHEN</span> a.event_date <span class="sql-keyword">IS NOT NULL THEN</span> <span class="sql-string">'YES'</span> 
         <span class="sql-keyword">ELSE</span> <span class="sql-string">'NO'</span> <span class="sql-keyword">END</span> <span class="sql-keyword">AS</span> returned_next_day
<span class="sql-keyword">FROM</span> (
    <span class="sql-keyword">SELECT</span> player_id, <span class="sql-function">MIN</span>(event_date) <span class="sql-keyword">AS</span> first_login
    <span class="sql-keyword">FROM</span> Activity
    <span class="sql-keyword">GROUP BY</span> player_id
) fl
<span class="sql-keyword">LEFT JOIN</span> Activity a 
<span class="sql-keyword">ON</span> fl.player_id = a.player_id 
<span class="sql-keyword">AND</span> a.event_date = <span class="sql-function">DATE_ADD</span>(fl.first_login, <span class="sql-keyword">INTERVAL</span> 1 <span class="sql-keyword">DAY</span>)
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üë• Visual Player Analysis</h2>
            <div class="visual-demo">
                <div class="player-card retention">
                    <h3>üü¢ Player 1 - RETAINED</h3>
                    <div class="timeline">
                        <div class="day-marker day-login">Mar 1</div>
                        <span>‚Üí</span>
                        <div class="day-marker day-login">Mar 2</div>
                    </div>
                    <p><strong>First Login:</strong> 2016-03-01</p>
                    <p><strong>Next Day Login:</strong> ‚úÖ YES (2016-03-02)</p>
                    <p><strong>Status:</strong> Retained player</p>
                </div>
                
                <div class="player-card no-retention">
                    <h3>üî¥ Player 2 - NOT RETAINED</h3>
                    <div class="timeline">
                        <div class="day-marker day-login">Jun 25</div>
                        <span>‚Üí</span>
                        <div class="day-marker day-no-login">Jun 26</div>
                    </div>
                    <p><strong>First Login:</strong> 2017-06-25</p>
                    <p><strong>Next Day Login:</strong> ‚ùå NO</p>
                    <p><strong>Status:</strong> Not retained</p>
                </div>
                
                <div class="player-card no-retention">
                    <h3>üî¥ Player 3 - NOT RETAINED</h3>
                    <div class="timeline">
                        <div class="day-marker day-login">Mar 2</div>
                        <span>‚Üí</span>
                        <div class="day-marker day-no-login">Mar 3</div>
                    </div>
                    <p><strong>First Login:</strong> 2016-03-02</p>
                    <p><strong>Next Day Login:</strong> ‚ùå NO</p>
                    <p><strong>Status:</strong> Not retained (next login was much later)</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üìà Final Calculation</h2>
            <div class="formula">
                Retention Fraction = Players who returned next day √∑ Total players
            </div>
            
            <div class="step">
                <h3>Complete SQL Solution:</h3>
                <div class="sql-code">
<span class="sql-keyword">SELECT</span> 
    <span class="sql-function">ROUND</span>(
        <span class="sql-function">COUNT</span>(a.player_id) * 1.0 / <span class="sql-function">COUNT</span>(fl.player_id), 
        2
    ) <span class="sql-keyword">AS</span> fraction
<span class="sql-keyword">FROM</span> (
    <span class="sql-keyword">SELECT</span> player_id, <span class="sql-function">MIN</span>(event_date) <span class="sql-keyword">AS</span> first_login
    <span class="sql-keyword">FROM</span> Activity
    <span class="sql-keyword">GROUP BY</span> player_id
) fl
<span class="sql-keyword">LEFT JOIN</span> Activity a 
<span class="sql-keyword">ON</span> fl.player_id = a.player_id 
<span class="sql-keyword">AND</span> a.event_date = <span class="sql-function">DATE_ADD</span>(fl.first_login, <span class="sql-keyword">INTERVAL</span> 1 <span class="sql-keyword">DAY</span>)
                </div>
            </div>
            
            <div class="step">
                <h3>Calculation Breakdown:</h3>
                <ul>
                    <li><strong>Total Players:</strong> 3 (players 1, 2, 3)</li>
                    <li><strong>Players who returned next day:</strong> 1 (only player 1)</li>
                    <li><strong>Fraction:</strong> 1 √∑ 3 = 0.33</li>
                </ul>
            </div>
        </div>

        <div class="result-highlight">
            üéØ Final Result: 0.33
        </div>

        <div class="section">
            <h2>üí° Key Insights</h2>
            <ul>
                <li><strong>LEFT JOIN is crucial:</strong> It ensures all players are counted, even those who didn't return</li>
                <li><strong>DATE_ADD function:</strong> Adds exactly 1 day to the first login date</li>
                <li><strong>COUNT behavior:</strong> COUNT(a.player_id) only counts non-NULL values (returned players)</li>
                <li><strong>Retention metric:</strong> This measures "Day 1 retention" - a key gaming industry KPI</li>
                <li><strong>Rounding:</strong> Result is rounded to 2 decimal places as specified</li>
            </ul>
        </div>
    </div>
</body>
</html>